# siki游戏开发中的设计模式

实用设计模式的目的：

1、解决同一种类型的问题；2、让代码结构更加清晰；

https://www.zhihu.com/question/19558521

每种设计模式符合面向对象设计中常见的设计原则：

###单一职责原则；

\1.  定义

​      i.  一个对象应该只包含单一的职责，并且该职责被完整地封装在一个类中。

​      ii. 就一个类而言，应该仅有一个引起它变化的原因。 

\2. 分析

​             i.  一个类（或者大到模块，小到方法）承担的职责越多，它被复用的可能性越小，而且如果一个类承担的职责过多，就相当于将这些职责耦合在一起，当其中一个职责变化时，可能会影响其他职责的运作。

​             ii.类的职责主要包括两个方面：数据职责和行为职责，数据职责通过其属性来体现，而行为职责通过其方法来体现。

​             iii.单一职责原则是实现高内聚、低耦合的指导方针，在很多代码重构手法中都能找到它的存在，它是最简单但又最难运用的原则，需要设计人员发现类的不同职责并将其分离，而发现类的多重职责需要设计人员具有较强的分析设计能力和相关重构经验。 

总结：就一个类而言，应该仅有一个引起它变化的原因。

###开-闭原则；

1. 开闭原则定义 ：一个软件实体应当对扩展开放，对修改关闭。也就是说在设计一个模块的时候，应当使这个模块可以在不被修改的前提下被扩展，即实现在不修改源代码的情况下改变这个模块的行为。

2. 开闭原则分析：

   （1）开闭原则由Bertrand Meyer于1988年提出，它是面向对象设计中最重要的原则之一。

   （2）在开闭原则的定义中，软件实体可以指一个软件模块、一个由多个类组成的局部结构或一个独立的类。

   （3）抽象化是开闭原则的关键。

   （4）开闭原则还可以通过一个更加具体的“对可变性封装原则”来描述，对可变性封装原则(Principle of Encapsulation of Variation,EVP)要求找到系统的可变因素并将其封装起来。

    

###里氏替换原则；

1. 定义

​       i.  如果对每一个类型为S的对象o1，都有类型为T的对象o2，使得以T定义的所有程序P在所有的对象o1都代换成o2时，程序P的行为没有变化，那么类型S是类型T的子类型。

​       ii. 所有引用基类（父类）的地方必须能透明地使用其子类的对象。

 

2.分析

​           i. 在软件中如果能够使用基类对象，那么一定能够使用其子类对象。把基类都替换成它的子类，程序将不会产生任何错误和异常，反过来则不成立，如果一个软件实体使用的是一个子类的话，那么它不一定能够使用基类。

​            ii. 里氏代换原则是实现开闭原则的重要方式之一，由于使用基类对象的地方都可以使用子类对象，因此在程序中尽量使用基类类型来对对象进行定义，而在运行时再确定其子类类型，用子类对象来替换父类对象。 

###依赖倒置原则；

 1.依赖倒转原则定义

​	i. 高层模块不应该依赖低层模块，它们都应该依赖抽象。抽象不应该依赖于细节，细节应该依赖于抽象。

​	ii. 要针对接口编程，不要针对实现编程。 

A调用 B，则A是 高层模块 B是低层模块

​            

2. 依赖倒转原则分析

   a)  简单来说，依赖倒转原则就是指：代码要依赖于抽象的类，而不要依赖于具体的类；要针对接口或抽象类编程，而不是针对具体类编程。

   ​

   b)  实现开闭原则的关键是抽象化，并且从抽象化导出具体化实现，如果说开闭原则是面向对象设计的目标的话，那么依赖倒转原则就是面向对象设计的主要手段。

   ​

   c) 依赖倒转原则的常用实现方式之一是在代码中使用抽象类，而将具体类放在配置文件中。

   d) 类之间的耦合 1.零耦合关系 2.具体耦合关系  3.抽象耦合关系。      依赖倒转原则要求客户端依赖于抽象耦合，以抽象方式耦合是依赖倒转原则的关键。

   e)  依赖注入:

   ​

   构造注入：通过构造函数注入实例变量

   设值注入：通过Setter方法注入实例变量

   接口注入：通过接口方法注入实例变量

###接口隔离原则；

\1. 定义

​        i.  客户端不应该依赖那些它不需要的接口。

​        ii.  一旦一个接口太大，则需要将它分割成一些更细小的接口，使用该接口的客户端仅需知道与之相关的方法即可。 

2.分析

​         i.  接口隔离原则是指使用多个专门的接口，而不使用单一的总接口。每一个接口应该承担一种相对独立的角色，不多不少，不干不该干的事，该干的事都要干。

​         ii. 使用接口隔离原则拆分接口时，首先必须满足单一职责原则，将一组相关的操作定义在一个接口中，且在满足高内聚的前提下，接口中的方法越少越好。

​        iii.  可以在进行系统设计时采用定制服务的方式，即为不同的客户端提供宽窄不同的接口，只提供用户需要的行为，而隐藏用户不需要的行为

总结：类应该完全依赖相应的专门的接口

###最少知识原则（迪米特法则）；

\1. 定义

​       i. 每一个软件单位对其他的单位都只有最少的知识，而且局限于那些与本单位密切相关的软件单位。

\2. 分析

​    i.迪米特法则就是指一个软件实体应当尽可能少的与其他实体发生相互作用。这样，当一个模块修改时，就会尽量少的影响其他的模块，扩展会相对容易，这是对软件实体之间通信的限制，它要求限制软件实体之间通信的宽度和深度。

​    ii. 狭义的迪米特法则：可以降低类之间的耦合，但是会在系统中增加大量的小方法并散落在系统的各个角落，它可以使一个系统的局部设计简化，因为每一个局部都不会和远距离的对象有直接的关联，但是也会造成系统的不同模块之间的通信效率降低，使得系统的不同模块之间不容易协调。

​    iii. 广义的迪米特法则：指对对象之间的信息流量、流向以及信息的影响的控制，主要是对信息隐藏的控制。信息的隐藏可以使各个子系统之间脱耦，从而允许它们独立地被开发、优化、使用和修改，同时可以促进软件的复用，由于每一个模块都不依赖于其他模块而存在，因此每一个模块都可以独立地在其他的地方使用。一个系统的规模越大，信息的隐藏就越重要，而信息隐藏的重要性也就越明显。

​     iv. 迪米特法则的主要用途在于控制信息的过载。

1.在类的划分上，应当尽量创建松耦合的类，类之间的耦合度越低，就越有利于复用，一个处在松耦合中的类一旦被修改，不会对关联的类造成太大波及

2.在类的结构设计上，每一个类都应当尽量降低其成员变量和成员函数的访问权限

3.在类的设计上，只要有可能，一个类型应当设计成不变类 

4.在对其他类的引用上，一个对象对其他对象的引用应当降到最低。 

总结：一个软件实体应当尽可能少的与其他实体发生相互作用

###少用继承多用组合（合成复用）；

1.定义

​         i. 尽量使用对象组合，而不是继承来达到复用的目的。

2.分析

​         i.  合成复用原则就是指在一个新的对象里通过关联关系（包括组合关系和聚合关系）来使用一些已有的对象，使之成为新对象的一部分；新对象通过委派调用已有对象的方法达到复用其已有功能的目的。简言之：要尽量使用组合/聚合关系，少用继承。

​         ii. 在面向对象设计中，可以通过两种基本方法在不同的环境中复用已有的设计和实现，即通过组合/聚合关系或通过继承。

a)  继承复用：实现简单，易于扩展。破坏系统的封装性；从基类继承而来的实现是静态的，不可能在运行时发生改变，没有足够的灵活性；只能在有限的环境中使用。（“白箱”复用 ）

b) 组合/聚合复用：耦合度相对较低，选择性地调用成员对象的操作；可以在运行时动态进行。（“黑箱”复用 ）                                                                       

​        iii. 组合/聚合可以使系统更加灵活，类与类之间的耦合度降低，一个类的变化对其他类造成的影响相对较少，因此一般首选使用组合/聚合来实现复用；其次才考虑继承，在使用继承时，需要严格遵循里氏代换原则，有效使用继承会有助于对问题的理解，降低复杂度，而滥用继承反而会增加系统构建和维护的难度以及系统的复杂度，因此需要慎重使用继承复用。

上述原则的作用：让自己涉及床来的软件系统更加稳定，容易维护，并具有一致性